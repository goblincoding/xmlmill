\hypertarget{gcmessagespace_8cpp_source}{\section{gcmessagespace.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/* Copyright (c) 2012 - 2013 by William Hallatt.}
00002 \textcolor{comment}{ *}
00003 \textcolor{comment}{ * This file forms part of "XML Mill".}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ * The official website for this project is <http://www.goblincoding.com> and,}
00006 \textcolor{comment}{ * although not compulsory, it would be appreciated if all works of whatever}
00007 \textcolor{comment}{ * nature using this source code (in whole or in part) include a reference to}
00008 \textcolor{comment}{ * this site.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ * Should you wish to contact me for whatever reason, please do so via:}
00011 \textcolor{comment}{ *}
00012 \textcolor{comment}{ *                 <http://www.goblincoding.com/contact>}
00013 \textcolor{comment}{ *}
00014 \textcolor{comment}{ * This program is free software: you can redistribute it and/or modify it
       under}
00015 \textcolor{comment}{ * the terms of the GNU General Public License as published by the Free
       Software}
00016 \textcolor{comment}{ * Foundation, either version 3 of the License, or (at your option) any later}
00017 \textcolor{comment}{ * version.}
00018 \textcolor{comment}{ *}
00019 \textcolor{comment}{ * This program is distributed in the hope that it will be useful, but WITHOUT}
00020 \textcolor{comment}{ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
       FITNESS}
00021 \textcolor{comment}{ * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
       details.}
00022 \textcolor{comment}{ *}
00023 \textcolor{comment}{ * You should have received a copy of the GNU General Public License along with}
00024 \textcolor{comment}{ * this program (GNUGPL.txt).  If not, see}
00025 \textcolor{comment}{ *}
00026 \textcolor{comment}{ *                    <http://www.gnu.org/licenses/>}
00027 \textcolor{comment}{ */}
00028 
00029 \textcolor{preprocessor}{#include "gcmessagespace.h"}
00030 \textcolor{preprocessor}{#include "ui\_gcmessagedialog.h"}
00031 \textcolor{preprocessor}{#include "utils/gcglobalspace.h"}
00032 
00033 \textcolor{preprocessor}{#include <QSettings>}
00034 \textcolor{preprocessor}{#include <QDialog>}
00035 \textcolor{preprocessor}{#include <QMessageBox>}
00036 
\hypertarget{gcmessagespace_8cpp_source_l00038}{}\hyperlink{class_g_c_message_dialog}{00038} \textcolor{keyword}{class }\hyperlink{class_g_c_message_dialog}{GCMessageDialog} : \textcolor{keyword}{public} QDialog
00039 \{
00040   Q\_OBJECT
00041 \textcolor{keyword}{public}:
00042 
\hypertarget{gcmessagespace_8cpp_source_l00051}{}\hyperlink{class_g_c_message_dialog_ad2f8910da38a44831096a9c7f1e08323}{00051}   \textcolor{keyword}{explicit} \hyperlink{class_g_c_message_dialog_ad2f8910da38a44831096a9c7f1e08323}{GCMessageDialog}( \textcolor{keywordtype}{bool} *remember,
00052                             \textcolor{keyword}{const} QString &heading,
00053                             \textcolor{keyword}{const} QString &text,
00054                             \hyperlink{namespace_g_c_message_space_ac1db082c29062fe6508ba03bf76bea44}{GCMessageSpace::ButtonCombo} buttons,
00055                             \hyperlink{namespace_g_c_message_space_a631906a7d53f30328cf2249a00078b5b}{GCMessageSpace::Buttons} defaultButton,
00056                             \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2}{GCMessageSpace::Icon} icon = \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2a54bba077357d6db019fb791266e133f0}{GCMessageSpace::NoIcon} 
      )
00057     :
00058       ui( new Ui::\hyperlink{class_g_c_message_dialog}{GCMessageDialog} ),
00059       m\_remember( remember )
00060   \{
00061     ui->setupUi( \textcolor{keyword}{this} );
00062     ui->textLabel->setText( text );
00063 
00064     \textcolor{keywordflow}{switch}( buttons )
00065     \{
00066     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_ac1db082c29062fe6508ba03bf76bea44ab2defe87f3e886edf34f537f4ac8c282}{GCMessageSpace::YesNo}:
00067       ui->acceptButton->setText( \textcolor{stringliteral}{"Yes"} );
00068       ui->rejectButton->setText( \textcolor{stringliteral}{"No"} );
00069       \textcolor{keywordflow}{break};
00070     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_ac1db082c29062fe6508ba03bf76bea44a7de67bd6b388b96a468fcf8246dfdece}{GCMessageSpace::OKCancel}:
00071       ui->acceptButton->setText( \textcolor{stringliteral}{"OK"} );
00072       ui->rejectButton->setText( \textcolor{stringliteral}{"Cancel"} );
00073       \textcolor{keywordflow}{break};
00074     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_ac1db082c29062fe6508ba03bf76bea44a3baa10aa8947d81b9001802c55131570}{GCMessageSpace::OKOnly}:
00075       ui->acceptButton->setText( \textcolor{stringliteral}{"OK"} );
00076       ui->rejectButton->setVisible( \textcolor{keyword}{false} );
00077     \}
00078 
00079     \textcolor{keywordflow}{switch}( defaultButton )
00080     \{
00081     \textcolor{keywordflow}{case} GCMessageSpace::Yes:
00082       \textcolor{comment}{/* Deliberate fall-through. */}
00083     \textcolor{keywordflow}{case} GCMessageSpace::OK:
00084       ui->acceptButton->setDefault( \textcolor{keyword}{true} );
00085       \textcolor{keywordflow}{break};
00086     \textcolor{keywordflow}{case} GCMessageSpace::No:
00087       \textcolor{comment}{/* Deliberate fall-through. */}
00088     \textcolor{keywordflow}{case} GCMessageSpace::Cancel:
00089       ui->rejectButton->setDefault( \textcolor{keyword}{true} );
00090     \}
00091 
00092     \textcolor{keywordflow}{switch}( icon )
00093     \{
00094     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2aa675bd9dc6c7b7735b0c1c20954b8323}{GCMessageSpace::Information}:
00095       ui->iconLabel->setPixmap( style()->standardIcon( 
      QStyle::SP\_MessageBoxInformation ).pixmap( 32, 32 ) );
00096       \textcolor{keywordflow}{break};
00097     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2ab454bae3ed7cef63f273c303aea6c4c3}{GCMessageSpace::Warning}:
00098       ui->iconLabel->setPixmap( style()->standardIcon( 
      QStyle::SP\_MessageBoxWarning ).pixmap( 32, 32 ) );
00099       \textcolor{keywordflow}{break};
00100     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2a4e02f76ed3971c8adbee5dd44724e8a6}{GCMessageSpace::Critical}:
00101       ui->iconLabel->setPixmap( style()->standardIcon( 
      QStyle::SP\_MessageBoxCritical ).pixmap( 32, 32 ) );
00102       \textcolor{keywordflow}{break};
00103     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2ae66d6709c87ccb0832b1456e2b4ad895}{GCMessageSpace::Question}:
00104       ui->iconLabel->setPixmap( style()->standardIcon( 
      QStyle::SP\_MessageBoxQuestion ).pixmap( 32, 32 ) );
00105       \textcolor{keywordflow}{break};
00106     \textcolor{keywordflow}{case} \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2a54bba077357d6db019fb791266e133f0}{GCMessageSpace::NoIcon}:
00107     \textcolor{keywordflow}{default}:
00108       ui->iconLabel->setPixmap( QPixmap() );
00109     \}
00110 
00111     connect( ui->checkBox,     SIGNAL( toggled( \textcolor{keywordtype}{bool} ) ), \textcolor{keyword}{this}, SLOT( 
      setRememberUserChoice( \textcolor{keywordtype}{bool} ) ) );
00112     connect( ui->acceptButton, SIGNAL( clicked() ),       \textcolor{keyword}{this}, SLOT( accept() 
      ) );
00113     connect( ui->rejectButton, SIGNAL( clicked() ),       \textcolor{keyword}{this}, SLOT( reject() 
      ) );
00114 
00115     setWindowTitle( heading );
00116   \}
00117 
\hypertarget{gcmessagespace_8cpp_source_l00119}{}\hyperlink{class_g_c_message_dialog_ae8f647f3c0a75c154f451d0a4fd6bd9d}{00119}   \hyperlink{class_g_c_message_dialog_ae8f647f3c0a75c154f451d0a4fd6bd9d}{~GCMessageDialog}()
00120   \{
00121     \textcolor{comment}{/* The variable that "m\_remember" points to is owned externally. */}
00122     \textcolor{keyword}{delete} ui;
00123   \}
00124 
00125 \textcolor{keyword}{private} slots:
00127   \textcolor{keywordtype}{void} setRememberUserChoice( \textcolor{keywordtype}{bool} remember )
00128   \{
00129     *m\_remember = remember;
00130   \}
00131 
00132 \textcolor{keyword}{private}:
00133   Ui::GCMessageDialog *ui;
00134   \textcolor{keywordtype}{bool} *m\_remember;
00135 \};
00136 
00137 \textcolor{comment}{/* Standard trick for classes defined in .cpp files (resolves "Undefined
       Reference}
00138 \textcolor{comment}{  to vtable for xxx issue). The file that seems "missing" at the moment is
       generated}
00139 \textcolor{comment}{  by MOC when qMake is run. Must include after class definition. */}
00140 \textcolor{preprocessor}{#include "gcmessagespace.moc"}
00141 
00142 \textcolor{comment}{/*
      --------------------------------------------------------------------------------------*/}
00143 
\hypertarget{gcmessagespace_8cpp_source_l00144}{}\hyperlink{namespace_g_c_message_space}{00144} \textcolor{keyword}{namespace }GCMessageSpace
00145 \{
00146   \textcolor{comment}{/* Hides our "member" variables. */}
00147   \textcolor{keyword}{namespace}
00148   \{
00149     QSettings settings( \hyperlink{namespace_g_c_global_space_a97583835f9987b1c94ff05802ccfe42f}{GCGlobalSpace::ORGANISATION}, \hyperlink{namespace_g_c_global_space_ab53b9c3447f00f1cc45a1d3fdfbba564}{GCGlobalSpace::APPLICATION}
       );
00150     \textcolor{keywordtype}{bool} settingsInitialised( \textcolor{keyword}{false} );
00151   \}
00152 
00153   \textcolor{comment}{/*
      ------------------------------------------------------------------------------------*/}
00154 
00155   \textcolor{comment}{/* Uses QSettings to save the user preference to the registry (Windows) or}
00156 \textcolor{comment}{    relevant XML files (Mac) or ini (Unix). */}
\hypertarget{gcmessagespace_8cpp_source_l00157}{}\hyperlink{namespace_g_c_message_space_ae6f97d25f38a6b35c49e6e67ce4afaca}{00157}   \textcolor{keywordtype}{bool} \hyperlink{namespace_g_c_message_space_ae6f97d25f38a6b35c49e6e67ce4afaca}{userAccepted}( \textcolor{keyword}{const} QString &uniqueMessageKey,
00158                      \textcolor{keyword}{const} QString &heading,
00159                      \textcolor{keyword}{const} QString &text,
00160                      \hyperlink{namespace_g_c_message_space_ac1db082c29062fe6508ba03bf76bea44}{ButtonCombo} buttons,
00161                      \hyperlink{namespace_g_c_message_space_a631906a7d53f30328cf2249a00078b5b}{Buttons} defaultButton,
00162                      \hyperlink{namespace_g_c_message_space_a67e94586e09cbc305257fbcdd7b686e2}{Icon} icon,
00163                      \textcolor{keywordtype}{bool} saveCancel )
00164   \{
00165     \textcolor{keywordflow}{if}( !settingsInitialised )
00166     \{
00167       settings.setValue( \textcolor{stringliteral}{"dialogPreferences"}, \textcolor{stringliteral}{""} );
00168       settingsInitialised = \textcolor{keyword}{true};
00169     \}
00170 
00171     \textcolor{comment}{/* Check if the user previously requested that his/her choice must be
       saved. */}
00172     QString key = QString( \textcolor{stringliteral}{"dialogPreferences/%1"} ).arg( uniqueMessageKey );
00173     QString valueKey = QString( key + \textcolor{stringliteral}{"/preference"} );
00174 
00175     \textcolor{keywordtype}{bool} remembered = settings.value( key, \textcolor{keyword}{false} ).toBool();
00176 
00177     \textcolor{keywordflow}{if}( !remembered )
00178     \{
00179       \hyperlink{class_g_c_message_dialog}{GCMessageDialog} dialog( &remembered, heading, text, buttons, 
      defaultButton, icon );
00180       QDialog::DialogCode accept = \textcolor{keyword}{static\_cast<} QDialog::DialogCode \textcolor{keyword}{>}( dialog.
      exec() );
00181 
00182       \textcolor{keywordflow}{if}( accept == QDialog::Accepted )
00183       \{
00184         \textcolor{keywordflow}{if}( remembered )
00185         \{
00186           settings.setValue( key, \textcolor{keyword}{true} );
00187           settings.setValue( valueKey, \textcolor{keyword}{true} );
00188         \}
00189 
00190         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00191       \}
00192       \textcolor{keywordflow}{else}
00193       \{
00194         \textcolor{comment}{/* For some message prompts, it isn't desirable to save "Cancel" values
       and}
00195 \textcolor{comment}{          it is therefore necessary to ensure that none of these values are
       remembered}
00196 \textcolor{comment}{          by accident. */}
00197         \textcolor{keywordflow}{if}( remembered )
00198         \{
00199           \textcolor{keywordflow}{if}( saveCancel )
00200           \{
00201             settings.setValue( key, \textcolor{keyword}{true} );
00202             settings.setValue( valueKey, \textcolor{keyword}{false} );
00203           \}
00204           \textcolor{keywordflow}{else}
00205           \{
00206             settings.setValue( key, \textcolor{keyword}{false} );
00207           \}
00208         \}
00209 
00210         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00211       \}
00212     \}
00213     \textcolor{keywordflow}{else}
00214     \{
00215       \textcolor{comment}{/* If we do have a remembered setting, act accordingly. */}
00216       \textcolor{keywordflow}{return} settings.value( valueKey ).toBool();
00217     \}
00218   \}
00219 
00220   \textcolor{comment}{/*
      ------------------------------------------------------------------------------------*/}
00221 
\hypertarget{gcmessagespace_8cpp_source_l00222}{}\hyperlink{namespace_g_c_message_space_ad9b01668af8368ac7e2c69065d45bf19}{00222}   \textcolor{keywordtype}{void} \hyperlink{namespace_g_c_message_space_ad9b01668af8368ac7e2c69065d45bf19}{forgetAllPreferences}()
00223   \{
00224     settings.beginGroup( \textcolor{stringliteral}{"dialogPreferences"} );
00225     settings.remove( \textcolor{stringliteral}{""} );
00226     settings.endGroup();
00227   \}
00228 
00229   \textcolor{comment}{/*
      ------------------------------------------------------------------------------------*/}
00230 
\hypertarget{gcmessagespace_8cpp_source_l00231}{}\hyperlink{namespace_g_c_message_space_ab118b3a133686167617eb955029fd44e}{00231}   \textcolor{keywordtype}{void} \hyperlink{namespace_g_c_message_space_ab118b3a133686167617eb955029fd44e}{showErrorMessageBox}( QWidget *parent, \textcolor{keyword}{const} QString &message )
00232   \{
00233     QMessageBox::critical( parent, \textcolor{stringliteral}{"Error!"}, message );
00234   \}
00235 \}
\end{DoxyCode}
